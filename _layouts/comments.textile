<!doctype html>  
<html lang="en">
<head>
  <meta charset="utf-8">

  <title>
    {% if page.title %}
      {{ page.title }} &mdash;
    {% endif %}
    Nathan Kerr
  </title>

  <style>
    body, select, input, textarea {
      background-color: #fff;
      color: #333;
      text-rendering: optimizelegibility;
    }

    header {
      border-bottom: 1px solid;
      margin-bottom: 1em;
      text-align: center;
    }
    header a {
      text-decoration: none;
      color: #222;
    }
  </style>
</head>

<body>

  <!-- sizeText -->
  <script>
    function ratio (x, y) {
      return Math.floor(10*(x / y))
    }

    var sheet = document.createElement('style')
    document.head.appendChild(sheet)

    var widthMetric = document.createElement('span')
    widthMetric.innerHTML = 'ABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLM'
    widthMetric.style.display = 'none'
    document.body.appendChild(widthMetric)

    var defaultFontSize = getComputedStyle(document.body).getPropertyValue("font-size")
    defaultFontSize = defaultFontSize.substr(0,defaultFontSize.length - 2) - 0
    var oldRatio = ratio(window.innerWidth, window.innerHeight)
    var windowWidth = window.innerWidth
    var windowHeight = window.innerHeight
    var zoomed = false

    // Tries to set an optimal font size for reading, 
    // balancing the length of the visible block while
    // maximizing the font-size (starting at whatever
    // document.body has)
    function sizeText() {
      if (oldRatio != ratio(window.innerWidth, window.innerHeight)) {
        // assume that we were not zoomed, update cached values
        oldRatio = ratio(window.innerHeight, window.innerHeight)
        windowWidth = window.innerWidth
        windowHeight = window.innerHeight
        zoomed = false
      } else {
        zoomed = true
      }

      // pick the optimal font size
      fontSize = defaultFontSize
      widthMetric.style.setProperty("font-size", fontSize + "px")
      widthMetric.style.display = 'inline'
      maxWidth = windowWidth - (windowWidth * 0.10) // make sure there are margins
      while(widthMetric.offsetWidth < maxWidth && widthMetric.offsetWidth < windowHeight) {
        fontSize = fontSize + 1
        widthMetric.style.setProperty("font-size", fontSize + "px")
      }

      // place the column of text in the middle and set the font-size
      marginWidth = ((windowWidth - widthMetric.offsetWidth) / 2) / windowWidth * 100
      if (marginWidth < 0) {marginWidth = 0}
      sheet.innerHTML = "body {line-height:1.5; max-width:" + widthMetric.offsetWidth + "px; font-size:" + fontSize + "px; margin-left:" + marginWidth + "%; margin-right:" + marginWidth + "%}"

      widthMetric.style.display = 'none'
    }

    // debounce from http://michalkuklis.com/blog/2011/06/04/debounce-in-javascript/
    function debounce(fn, wait) {
      var timeout = null
      return function () {
        clearTimeout(timeout)
        var args = arguments
        var ctx = this
        timeout = setTimeout(function () {
          fn.apply(ctx, args)
        }, wait)
      }
    }

    window.onresize = debounce(sizeText,200)
    sizeText()
  </script>
  <header>
    <a style="font-size: 200%" href="/">Nathan Kerr</a><br/>
    <a href="/">Blog</a>
    | <a href="/about">About</a>
    | <a href="/projects">Projects</a>
  </header>

  <h1 id="title">{{ page.title }}</h1>
  {{ content }}

  <!-- Disqus -->
  <div id="disqus_thread"></div><script type="text/javascript" src="http://disqus.com/forums/nathankerr/embed.js"></script><noscript><a href="http://nathankerr.disqus.com/?url=ref">View the discussion thread.</a></noscript>
  <script type="text/javascript">
    //<![CDATA[
    (function() {
      var links = document.getElementsByTagName('a');
      var query = '?';
      for(var i = 0; i < links.length; i++) {
        if(links[i].href.indexOf('#disqus_thread') >= 0) {
          query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
        }
      }
      document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/nathankerr/get_num_replies.js' + query + '"></' + 'script>');
    })();
    //]]>
  </script>

  <!-- Google Analytics -->
  <script>
   var _gaq = [['_setAccount', 'UA-1960166-2'], ['_trackPageview']];
   (function(d, t) {
    var g = d.createElement(t),
        s = d.getElementsByTagName(t)[0];
    g.async = true;
    g.src = ('https:' == location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g, s);
   })(document, 'script');
  </script>

  <!-- Woopra -->
  <script type="text/javascript">
    (function(){
      var wsc=document.createElement('script');
      wsc.type='text/javascript';
      wsc.src=document.location.protocol+'//static.woopra.com/js/woopra.js';
      wsc.async=true;
      var ssc = document.getElementsByTagName('script')[0];
      ssc.parentNode.insertBefore(wsc, ssc);
    })();
  </script>

</body>
</html>